<div class="w-full">
  <!-- Multiple Selection Mode -->
  @if (multiple) {
  <p-multiSelect
    #multiSelectRef
    [options]="authorOptions"
    [(ngModel)]="selectedAuthorIds"
    [placeholder]="placeholder"
    [disabled]="disabled"
    [filter]="filter"
    [showClear]="showClear"
    [maxSelectedLabels]="maxSelectedLabels"
    class="w-full"
    (onChange)="onSelectionChange($event)"
    optionLabel="label"
    optionValue="value"
    [showHeader]="true"
  >
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between px-3 py-2 border-b">
        <span class="font-medium">Select Authors</span>
        @if (showAddButton) {
        <button
          type="button"
          class="text-blue-600 hover:text-blue-800 text-sm font-medium"
          (click)="onAddNewAuthor()"
        >
          + Add New
        </button>
        }
      </div>
    </ng-template>
  </p-multiSelect>
  }

  <!-- Single Selection Mode -->
  @if (!multiple) {
  <p-select
    #dropdownRef
    [options]="authorOptions"
    [(ngModel)]="selectedAuthorIds"
    [placeholder]="placeholder"
    [disabled]="disabled"
    [filter]="filter"
    [showClear]="showClear"
    class="w-full"
    (onChange)="onSelectionChange($event)"
    optionLabel="label"
    optionValue="value"
  >
    <ng-template pTemplate="header">
      <div class="flex items-center justify-between px-3 py-2 border-b">
        <span class="font-medium">Select Author</span>
        @if (showAddButton) {
        <button
          type="button"
          class="text-blue-600 hover:text-blue-800 text-sm font-medium"
          (click)="onAddNewAuthor()"
        >
          + Add New
        </button>
        }
      </div>
    </ng-template>
  </p-select>
  }
</div>

<!-- Add New Author Dialog -->
<p-dialog
  header="Add New Author"
  [(visible)]="showAddAuthorDialog"
  [modal]="true"
  [style]="{ width: '650px', maxWidth: '95vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="authorService.authorForm" class="space-y-5">
    <!-- Basic Information Section -->
    <div class="space-y-3.5">
      <div
        class="flex items-center gap-2 pb-2 border-b border-surface-200 dark:border-surface-700"
      >
        <i class="pi pi-user text-primary-500 text-sm"></i>
        <h3
          class="text-base font-semibold text-surface-900 dark:text-surface-100"
        >
          Basic Information
        </h3>
      </div>

      <div class="space-y-1.5">
        <label
          for="name"
          class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
        >
          Author Name <span class="text-red-500">*</span>
        </label>
        <input
          id="name"
          type="text"
          pInputText
          formControlName="name"
          class="w-full"
          placeholder="Enter full name"
        />
      </div>

      <div class="space-y-1.5">
        <label
          for="bio"
          class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
          >Biography</label
        >
        <textarea
          id="bio"
          pTextarea
          formControlName="bio"
          rows="3"
          class="w-full resize-none"
          placeholder="Brief description about the author..."
        ></textarea>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div class="space-y-1.5">
          <label
            for="birthDate"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Birth Date</label
          >
          <p-datePicker
            id="birthDate"
            formControlName="birthDate" appendTo="body"
            [showIcon]="true"
            dateFormat="yy-mm-dd"
            styleClass="w-full"
            placeholder="Select date"
          />
        </div>

        <div class="space-y-1.5">
          <label
            for="deathDate"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Death Date</label
          >
          <p-datePicker
            id="deathDate"
            formControlName="deathDate" appendTo="body"
            [showIcon]="true"
            dateFormat="yy-mm-dd"
            styleClass="w-full"
            placeholder="Select date"
          />
        </div>
      </div>

      <div class="space-y-1.5">
        <label
          for="nationality"
          class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
          >Nationality</label
        >
        <input
          id="nationality"
          type="text"
          pInputText
          formControlName="nationality"
          class="w-full"
          placeholder="e.g., American, British"
        />
      </div>
    </div>

    <!-- Social Links Section -->
    <div class="space-y-3.5">
      <div
        class="flex items-center gap-2 pb-2 border-b border-surface-200 dark:border-surface-700"
      >
        <i class="pi pi-link text-primary-500 text-sm"></i>
        <h3
          class="text-base font-semibold text-surface-900 dark:text-surface-100"
        >
          Social Links
        </h3>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div class="space-y-1.5">
          <label
            for="website"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Website</label
          >
          <input
            id="website"
            type="url"
            pInputText
            formControlName="website"
            class="w-full"
            placeholder="https://..."
          />
        </div>

        <div class="space-y-1.5">
          <label
            for="instagramUrl"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Instagram</label
          >
          <input
            id="instagramUrl"
            type="text"
            pInputText
            formControlName="instagramUrl"
            class="w-full"
            placeholder="@username"
          />
        </div>

        <div class="space-y-1.5">
          <label
            for="goodreadUrl"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Goodreads</label
          >
          <input
            id="goodreadUrl"
            type="url"
            pInputText
            formControlName="goodreadUrl"
            class="w-full"
            placeholder="https://goodreads.com/..."
          />
        </div>

        <div class="space-y-1.5">
          <label
            for="threadsUrl"
            class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
            >Threads</label
          >
          <input
            id="threadsUrl"
            type="text"
            pInputText
            formControlName="threadsUrl"
            class="w-full"
            placeholder="@username"
          />
        </div>
      </div>
    </div>

    <!-- Personal Preferences Section -->
    <div class="space-y-3.5">
      <div
        class="flex items-center gap-2 pb-2 border-b border-surface-200 dark:border-surface-700"
      >
        <i class="pi pi-heart text-primary-500 text-sm"></i>
        <h3
          class="text-base font-semibold text-surface-900 dark:text-surface-100"
        >
          Personal Preferences
        </h3>
      </div>

      <div class="space-y-1.5">
        <label
          for="preferenceLevel"
          class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
          >Preference Level</label
        >
        <p-select
          id="preferenceLevel"
          formControlName="preferenceLevel" appendTo="body"
          [options]="preferenceLevelOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="How much do you like this author?"
          styleClass="w-full"
        />
      </div>

      <div class="flex gap-4">
        <div
          class="flex items-center gap-2.5 flex-1 px-3 py-2.5 bg-surface-50 dark:bg-surface-800/50 rounded-md border border-surface-200 dark:border-surface-700"
        >
          <p-checkbox
            formControlName="isFavorite"
            [binary]="true"
            inputId="isFavorite"
          />
          <label
            for="isFavorite"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 cursor-pointer flex items-center gap-1.5"
          >
            <i class="pi pi-star text-yellow-500 text-xs"></i>
            <span>Favorite</span>
          </label>
        </div>

        <div
          class="flex items-center gap-2.5 flex-1 px-3 py-2.5 bg-surface-50 dark:bg-surface-800/50 rounded-md border border-surface-200 dark:border-surface-700"
        >
          <p-checkbox
            formControlName="isExcluded"
            [binary]="true"
            inputId="isExcluded"
          />
          <label
            for="isExcluded"
            class="text-sm font-medium text-surface-700 dark:text-surface-300 cursor-pointer flex items-center gap-1.5"
          >
            <i class="pi pi-ban text-red-500 text-xs"></i>
            <span>Exclude</span>
          </label>
        </div>
      </div>

      <div class="space-y-1.5">
        <label
          for="personalNotes"
          class="block text-xs font-semibold text-surface-700 dark:text-surface-300"
          >Personal Notes</label
        >
        <textarea
          id="personalNotes"
          pTextarea
          formControlName="personalNotes"
          rows="3"
          class="w-full resize-none"
          placeholder="Add your thoughts about this author..."
        ></textarea>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="flex gap-2 justify-end">
      <button
        pButton
        label="Cancel"
        (click)="onAddAuthorDialogCancel()"
        class="p-button-text p-button-secondary"
      ></button>
      <button
        pButton
        label="Save Author"
        icon="pi pi-check"
        (click)="onAddAuthorDialogSave()"
        [disabled]="authorService.authorForm.invalid"
        class="p-button-primary"
      ></button>
    </div>
  </ng-template>
</p-dialog>
