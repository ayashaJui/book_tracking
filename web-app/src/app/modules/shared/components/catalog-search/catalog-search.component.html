<div class="catalog-search-container relative">
  <!-- Search Input -->
  <div class="search-input-wrapper">
    <div class="relative">
      <span
        class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
      >
        <i class="pi pi-search"></i>
      </span>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onSearchInput($event)"
        (focus)="showResultsPanel()"
        [placeholder]="placeholder"
        class="w-full pl-10 pr-10 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400 dark:placeholder-gray-500"
      />
      <button
        *ngIf="searchQuery"
        (click)="clearSearch()"
        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
      >
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div
    *ngIf="isSearching"
    class="absolute top-full left-0 right-0 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-b-lg shadow-lg"
  >
    <div class="p-4 text-center">
      <i class="pi pi-spin pi-spinner text-blue-500 mr-2"></i>
      <span class="text-gray-600 dark:text-gray-400">Searching catalog...</span>
    </div>
  </div>

  <!-- Search Results -->
  <div
    *ngIf="showResults && !isSearching"
    class="absolute top-full left-0 right-0 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-b-lg shadow-lg max-h-96 overflow-y-auto"
  >
    <!-- Results found -->
    <div *ngIf="hasResults">
      <div
        class="p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700"
      >
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
          Found {{ searchResults.length }} results in catalog
        </span>
      </div>

      <div class="max-h-72 overflow-y-auto">
        <button
          *ngFor="let item of searchResults"
          (click)="onItemClick(item)"
          class="w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0 transition-colors duration-150"
        >
          <div class="flex items-start space-x-3">
            <!-- Item Icon -->
            <div class="flex-shrink-0 mt-1">
              <i
                [class]="getTypeIcon(item.type)"
                class="text-blue-500 text-lg"
              ></i>
            </div>

            <!-- Item Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-1">
                <span
                  class="font-medium text-gray-900 dark:text-white truncate"
                >
                  {{ item.name || item.title }}
                </span>
                <span
                  class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200"
                >
                  {{ getTypeLabel(item.type) }}
                </span>
              </div>

              <p
                *ngIf="item.description"
                class="text-sm text-gray-600 dark:text-gray-400 truncate"
              >
                {{ item.description }}
              </p>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- No results found -->
    <div *ngIf="showNoResults">
      <div class="p-4 text-center">
        <i class="pi pi-search text-gray-400 text-2xl mb-2"></i>
        <p class="text-gray-600 dark:text-gray-400 mb-3">
          No results found for "{{ searchQuery }}"
        </p>

        <button
          *ngIf="canCreateNew"
          (click)="onCreateNewClick()"
          class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors duration-200"
        >
          <i class="pi pi-plus mr-2"></i>
          Create New {{ getTypeLabel(searchType) }}
        </button>
      </div>
    </div>
  </div>

  <!-- Search Instructions -->
  <div
    *ngIf="
      !hasSearched &&
      !isSearching &&
      searchQuery.length < minCharacters &&
      searchQuery.length > 0
    "
    class="absolute top-full left-0 right-0 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-b-lg shadow-lg"
  >
    <div class="p-3 text-center text-sm text-gray-500 dark:text-gray-400">
      Type at least {{ minCharacters }} characters to search
    </div>
  </div>
</div>
