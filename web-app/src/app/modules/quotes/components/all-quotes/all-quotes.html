<!-- Loading State -->
<div *ngIf="loading" class="flex items-center justify-center min-h-screen">
  <div class="text-center">
    <div
      class="p-8 bg-white/70 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 mb-4"
    >
      <i class="pi pi-spin pi-spinner text-4xl text-indigo-600 mb-4 block"></i>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">
        Loading your quotes...
      </h3>
      <p class="text-gray-500">Please wait while we fetch your collection</p>
    </div>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="!loading" class="animate-fade-in-up">
  <!-- Modern Header Section -->
  <div
    class="relative overflow-hidden bg-white rounded-2xl dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700"
  >
    <!-- Background Pattern -->
    <div
      class="absolute inset-0 bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-100 dark:from-gray-800 dark:via-gray-900 dark:to-gray-900"
    ></div>
    <div class="absolute inset-0 opacity-30 dark:opacity-10">
      <div
        class="w-full h-full"
        style="
          background-image: radial-gradient(
            circle at 1px 1px,
            rgba(99, 102, 241, 0.3) 1px,
            transparent 0
          );
          background-size: 20px 20px;
        "
      ></div>
    </div>

    <div class="relative px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
      <div class="max-w-7xl mx-auto">
        <div
          class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 lg:gap-8"
        >
          <!-- Left Side - Title and Description -->
          <div class="flex-1">
            <div class="flex items-center gap-4">
              <div
                class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg"
              >
                <i class="pi pi-comments text-white text-xl"></i>
              </div>
              <div>
                <h1
                  class="text-3xl lg:text-4xl font-bold text-gray-800 dark:text-white tracking-tight"
                >
                  Quotes Collection
                </h1>
                <p
                  class="text-gray-600 dark:text-gray-300 text-sm lg:text-base mt-1"
                >
                  Capture and organize your favorite quotes and inspirations
                </p>
              </div>
            </div>
          </div>

          <!-- Right Side - Quick Stats -->
          <div class="flex-shrink-0 w-full lg:w-auto">
            <div class="grid grid-cols-3 gap-4 lg:gap-6">
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto group hover:scale-105 transition-transform duration-200"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-blue-600 dark:text-blue-300 group-hover:scale-110 transition-transform duration-200"
                    >{{ filteredQuotes.length }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-300"
                >
                  Quotes
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto group hover:scale-105 transition-transform duration-200"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-green-600 dark:text-green-300 group-hover:scale-110 transition-transform duration-200"
                    >{{ getFavoriteQuotes().length }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-300"
                >
                  Favorites
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto group hover:scale-105 transition-transform duration-200"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-purple-600 dark:text-purple-300 group-hover:scale-110 transition-transform duration-200"
                    >{{ getTagCount() }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-300"
                >
                  Tags
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Container -->
  <div class="lg:px-6 py-6 lg:py-8">
    <!-- Action Buttons -->
    <div class="mb-8">
      <div
        class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
      >
        <div class="flex items-center gap-4">
          <!-- Enhanced view toggle -->
          <div class="flex items-center gap-2 p-1 rounded-lg">
            <button
              pButton
              type="button"
              [class]="
                viewMode === 'table' ? 'p-button-filled' : 'p-button-text'
              "
              icon="pi pi-table"
              class="p-button-sm rounded-md transition-all duration-200"
              (click)="viewMode = 'table'"
              pTooltip="Table View"
            ></button>
            <button
              pButton
              type="button"
              [class]="
                viewMode === 'card' ? 'p-button-filled' : 'p-button-text'
              "
              icon="pi pi-th-large"
              class="p-button-sm rounded-md transition-all duration-200"
              (click)="viewMode = 'card'"
              pTooltip="Card View"
            ></button>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button
            pButton
            label="Add Quote"
            icon="pi pi-plus"
            class="p-button-primary p-button-raised"
            (click)="navigateToAddQuote()"
          ></button>
          <button
            pButton
            label="Manage Tags"
            icon="pi pi-tags"
            class="p-button-outlined"
            (click)="openTagDialog()"
          ></button>
          <button
            pButton
            [label]="showFavoritesOnly ? 'Show All' : 'Favorites Only'"
            [icon]="showFavoritesOnly ? 'pi pi-list' : 'pi pi-star'"
            [class]="
              showFavoritesOnly ? 'p-button-warning' : 'p-button-outlined'
            "
            (click)="toggleFavoritesFilter()"
          ></button>
          <button
            pButton
            label="Export"
            icon="pi pi-download"
            class="p-button-outlined"
            (click)="exportQuotesCSV()"
          ></button>
          <input
            type="file"
            accept=".csv"
            (change)="importQuotesCSV($event)"
            class="hidden"
            #fileInput
          />
          <button
            pButton
            icon="pi pi-upload"
            class="p-button-outlined"
            (click)="fileInput.click()"
            pTooltip="Import CSV"
          ></button>
        </div>
      </div>
    </div>

    <!-- Enhanced Filters Section -->
    <div class="mb-8">
      <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden"
      >
        <!-- Filter Header -->
        <div
          class="px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"
        >
          <div class="flex items-center justify-between">
            <h3
              class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2"
            >
              <i class="pi pi-filter text-blue-500"></i>
              Search & Filters
            </h3>
            <button
              *ngIf="hasActiveFilters()"
              pButton
              label="Clear All"
              icon="pi pi-times"
              class="p-button-text p-button-sm"
              (click)="clearFilters()"
            ></button>
          </div>
        </div>

        <!-- Filter Content -->
        <div class="p-6">
          <form
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
            (submit)="$event.preventDefault()"
          >
            <!-- Global Search -->
            <div class="lg:col-span-2">
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Search Quotes
              </label>
              <span class="p-input-icon-left w-full">
                <i class="pi pi-search"></i>
                <input
                  pInputText
                  type="search"
                  placeholder="Search quotes, books, authors..."
                  [(ngModel)]="globalFilter"
                  (input)="applyFilters()"
                  name="globalFilter"
                  autocomplete="off"
                  class="w-full"
                />
              </span>
            </div>

            <!-- Tag Filter -->
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Filter by Tags
              </label>
              <p-multiSelect
                [options]="tagOptions"
                [(ngModel)]="selectedTags"
                optionLabel="label"
                optionValue="value"
                placeholder="Select tags"
                (onChange)="applyFilters()"
                [showClear]="true"
                name="tags"
                class="w-full"
                [maxSelectedLabels]="2"
                selectedItemsLabel="{0} tags selected"
              ></p-multiSelect>
            </div>

            <!-- Book Filter -->
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Filter by Book
              </label>
              <p-select
                [options]="bookOptions"
                [(ngModel)]="selectedBook"
                optionLabel="label"
                optionValue="value"
                placeholder="Select book"
                (onChange)="applyFilters()"
                [showClear]="true"
                name="book"
                class="w-full"
              ></p-select>
            </div>
          </form>

          <!-- Active Filters Display -->
          <div
            *ngIf="hasActiveFilters()"
            class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-600"
          >
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
                >Active filters:</span
              >
              <p-chip
                *ngIf="globalFilter"
                [label]="'Search: ' + globalFilter"
                [removable]="true"
                (onRemove)="globalFilter = ''; applyFilters()"
              ></p-chip>
              <p-chip
                *ngIf="selectedBook"
                [label]="'Book: ' + selectedBook"
                [removable]="true"
                (onRemove)="selectedBook = null; applyFilters()"
              ></p-chip>
              <p-chip
                *ngIf="showFavoritesOnly"
                label="Favorites Only"
                [removable]="true"
                (onRemove)="showFavoritesOnly = false; applyFilters()"
              ></p-chip>
              <p-chip
                *ngFor="let tag of selectedTags"
                [label]="'Tag: ' + tag"
                [removable]="true"
                (onRemove)="toggleTagFilter(tag)"
              ></p-chip>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Display -->
    <div
      class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden"
    >
      <!-- Results Header -->
      <div
        class="px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"
      >
        <div class="flex items-center justify-between">
          <h3
            class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2"
          >
            <i class="pi pi-list text-blue-500"></i>
            Your Quotes
            <p-badge
              [value]="filteredQuotes.length.toString()"
              severity="info"
            ></p-badge>
          </h3>
          <span class="text-sm text-gray-600 dark:text-gray-400">
            Showing {{ filteredQuotes.length }} of {{ quotes.length }} quotes
          </span>
        </div>
      </div>

      <!-- Table View -->
      <div *ngIf="viewMode === 'table'">
        <p-table
          #dt
          [value]="filteredQuotes"
          [paginator]="true"
          [rows]="10"
          [rowsPerPageOptions]="[5, 10, 20, 50]"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
          responsiveLayout="scroll"
          [globalFilterFields]="['quote', 'book', 'author']"
          sortMode="multiple"
          [loading]="loading"
          styleClass="p-datatable-lg"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="quote" class="min-w-[350px]">
                <div class="flex items-center gap-2">
                  <i class="pi pi-comment text-gray-500"></i>
                  Quote
                  <p-sortIcon field="quote"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="book" class="min-w-[200px]">
                <div class="flex items-center gap-2">
                  <i class="pi pi-book text-gray-500"></i>
                  Book & Author
                  <p-sortIcon field="book"></p-sortIcon>
                </div>
              </th>
              <th class="min-w-[150px]">
                <div class="flex items-center gap-2">
                  <i class="pi pi-tags text-gray-500"></i>
                  Tags
                </div>
              </th>
              <th style="width: 80px" class="text-center">
                <div class="flex items-center justify-center gap-2">
                  <i class="pi pi-star text-gray-500"></i>
                  Favorite
                </div>
              </th>
              <th style="width: 160px" class="text-center">
                <div class="flex items-center justify-center gap-2">
                  <i class="pi pi-cog text-gray-500"></i>
                  Actions
                </div>
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-quote let-rowIndex="rowIndex">
            <tr
              class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150"
            >
              <td class="p-4">
                <div class="max-w-md">
                  <p
                    class="text-gray-800 dark:text-gray-200 leading-relaxed line-clamp-3"
                    [pTooltip]="quote.quote"
                  >
                    "{{ quote.quote }}"
                  </p>
                </div>
              </td>
              <td class="p-4">
                <div class="space-y-1">
                  <div class="font-medium text-gray-700 dark:text-gray-300">
                    {{ quote.book }}
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">
                    by {{ quote.author }}
                  </div>
                  <div *ngIf="quote.pageNumber" class="text-xs text-gray-500">
                    <i class="pi pi-file mr-1"></i>Page {{ quote.pageNumber }}
                  </div>
                </div>
              </td>
              <td class="p-4">
                <div class="flex flex-wrap gap-1 max-w-xs">
                  <p-tag
                    *ngFor="let tag of quote.tags"
                    [value]="tag"
                    [severity]="getTagSeverity(tag)"
                    class="text-xs"
                  ></p-tag>
                </div>
              </td>
              <td class="text-center p-4">
                <button
                  pButton
                  [icon]="quote.favorite ? 'pi pi-star-fill' : 'pi pi-star'"
                  class="p-button-rounded p-button-text"
                  [class.text-yellow-500]="quote.favorite"
                  [class.text-gray-400]="!quote.favorite"
                  (click)="toggleFavorite(quote)"
                  [pTooltip]="
                    quote.favorite
                      ? 'Remove from favorites'
                      : 'Add to favorites'
                  "
                ></button>
              </td>
              <td class="text-center p-4">
                <div class="flex items-center justify-center gap-1">
                  <button
                    pButton
                    icon="pi pi-eye"
                    class="p-button-rounded p-button-text p-button-sm"
                    (click)="viewQuoteDetails(quote)"
                    pTooltip="View Details"
                  ></button>
                  <button
                    pButton
                    icon="pi pi-pencil"
                    class="p-button-rounded p-button-text p-button-sm text-blue-600"
                    (click)="editQuote(quote)"
                    pTooltip="Edit Quote"
                  ></button>
                  <button
                    pButton
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-text p-button-sm text-red-600"
                    (click)="deleteQuote(quote)"
                    pTooltip="Delete Quote"
                  ></button>
                </div>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="empty">
            <tr>
              <td colspan="5" class="text-center p-8">
                <div class="flex flex-col items-center gap-4">
                  <i class="pi pi-search text-4xl text-gray-300"></i>
                  <div>
                    <p class="text-lg font-medium text-gray-600 mb-2">
                      No quotes found
                    </p>
                    <p class="text-gray-500">
                      {{
                        hasActiveFilters()
                          ? "Try adjusting your filters or search terms"
                          : "Start by adding your first quote"
                      }}
                    </p>
                  </div>
                  <button
                    *ngIf="!hasActiveFilters()"
                    pButton
                    label="Add Your First Quote"
                    icon="pi pi-plus"
                    class="p-button-outlined"
                    (click)="navigateToAddQuote()"
                  ></button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Card View -->
      <div *ngIf="viewMode === 'card'" class="p-6">
        <p-paginator
          [rows]="12"
          [totalRecords]="filteredQuotes.length"
          [first]="currentPageFirst"
          (onPageChange)="onPageChange($event)"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} quotes"
        ></p-paginator>

        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-6"
        >
          <div
            *ngFor="let quote of getPaginatedQuotes()"
            class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-700 dark:to-gray-800 rounded-xl border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300 hover:transform hover:scale-105"
          >
            <!-- Quote Header -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <h4
                  class="font-semibold text-gray-800 dark:text-white text-sm truncate"
                >
                  {{ quote.book }}
                </h4>
                <p class="text-xs text-gray-600 dark:text-gray-400 truncate">
                  by {{ quote.author }}
                </p>
              </div>
              <button
                pButton
                [icon]="quote.favorite ? 'pi pi-star-fill' : 'pi pi-star'"
                class="p-button-rounded p-button-text p-button-sm"
                [class.text-yellow-500]="quote.favorite"
                [class.text-gray-400]="!quote.favorite"
                (click)="toggleFavorite(quote)"
              ></button>
            </div>

            <!-- Quote Text -->
            <blockquote
              class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed mb-4 line-clamp-4 italic"
            >
              "{{ quote.quote }}"
            </blockquote>

            <!-- Tags -->
            <div class="flex flex-wrap gap-1 mb-4">
              <p-tag
                *ngFor="let tag of quote.tags.slice(0, 3)"
                [value]="tag"
                [severity]="getTagSeverity(tag)"
                class="text-xs"
              ></p-tag>
              <span *ngIf="quote.tags.length > 3" class="text-xs text-gray-500"
                >+{{ quote.tags.length - 3 }} more</span
              >
            </div>

            <!-- Footer -->
            <div
              class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-600"
            >
              <div class="flex items-center gap-2 text-xs text-gray-500">
                <i class="pi pi-calendar"></i>
                <span>{{ quote.dateAdded | date : "shortDate" }}</span>
                <span *ngIf="quote.pageNumber" class="ml-2">
                  <i class="pi pi-file"></i>
                  p.{{ quote.pageNumber }}
                </span>
              </div>
              <div class="flex items-center gap-1">
                <button
                  pButton
                  icon="pi pi-eye"
                  class="p-button-rounded p-button-text p-button-sm"
                  (click)="viewQuoteDetails(quote)"
                  pTooltip="View Details"
                ></button>
                <button
                  pButton
                  icon="pi pi-pencil"
                  class="p-button-rounded p-button-text p-button-sm"
                  (click)="editQuote(quote)"
                  pTooltip="Edit"
                ></button>
                <button
                  pButton
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-text p-button-sm text-red-600"
                  (click)="deleteQuote(quote)"
                  pTooltip="Delete"
                ></button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="filteredQuotes.length === 0" class="text-center py-12">
          <div class="flex flex-col items-center gap-4">
            <i class="pi pi-search text-4xl text-gray-300"></i>
            <div>
              <p class="text-lg font-medium text-gray-600 mb-2">
                No quotes found
              </p>
              <p class="text-gray-500">
                {{
                  hasActiveFilters()
                    ? "Try adjusting your filters or search terms"
                    : "Start by adding your first quote"
                }}
              </p>
            </div>
            <button
              *ngIf="!hasActiveFilters()"
              pButton
              label="Add Your First Quote"
              icon="pi pi-plus"
              class="p-button-outlined"
              (click)="navigateToAddQuote()"
            ></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Manage Tags Dialog -->
<p-dialog
  header="Manage Tags"
  [(visible)]="displayTagDialog"
  [modal]="true"
  [style]="{ width: '95vw', minWidth: '320px', maxWidth: '800px' }"
  [closeOnEscape]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
>
  <ng-template pTemplate="header">
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
      <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
        <i class="pi pi-tags text-purple-600 dark:text-purple-400"></i>
      </div>
      <div>
        <h3
          class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200"
        >
          Manage Tags
        </h3>
        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
          Create, edit, and organize your quote tags
        </p>
      </div>
    </div>
  </ng-template>

  <div class="space-y-4 sm:space-y-6">
    <!-- Tag Statistics -->
    <div
      class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-3 sm:p-4 border border-purple-200 dark:border-purple-800"
    >
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 text-center">
        <div>
          <div
            class="text-xl sm:text-2xl font-bold text-purple-600 dark:text-purple-400"
          >
            {{ getTagCount() }}
          </div>
          <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
            Total Tags
          </div>
        </div>
        <div>
          <div
            class="text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400"
          >
            {{ getMostUsedTag().count }}
          </div>
          <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
            Most Used
          </div>
        </div>
        <div>
          <div
            class="text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400"
          >
            {{ getUnusedTags().length }}
          </div>
          <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
            Unused
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Tag -->
    <div
      class="border border-gray-200 dark:border-gray-700 rounded-lg p-3 sm:p-4"
    >
      <h4
        class="font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm sm:text-base"
      >
        <i class="pi pi-plus text-green-500"></i>
        Add New Tag
      </h4>
      <div class="flex flex-col sm:flex-row gap-3">
        <input
          type="text"
          [(ngModel)]="newTagName"
          class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm"
          placeholder="Enter tag name..."
          (keyup.enter)="addNewTag()"
        />
        <button
          pButton
          label="Add"
          icon="pi pi-plus"
          class="p-button-success p-button-sm w-full sm:w-auto"
          (click)="addNewTag()"
          [disabled]="!newTagName.trim()"
        ></button>
      </div>
    </div>

    <!-- Existing Tags -->
    <div
      class="border border-gray-200 dark:border-gray-700 rounded-lg p-3 sm:p-4"
    >
      <h4
        class="font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm sm:text-base"
      >
        <i class="pi pi-list text-blue-500"></i>
        Existing Tags ({{ getTagCount() }})
      </h4>

      <div class="space-y-2 sm:space-y-3 max-h-48 sm:max-h-60 overflow-y-auto">
        <div
          *ngFor="let tag of tagCounts | keyvalue"
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-2 sm:p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors gap-2 sm:gap-0"
        >
          <div class="flex items-center gap-2 sm:gap-3">
            <p-tag
              [value]="tag.key"
              [severity]="getTagSeverity(tag.key)"
            ></p-tag>
            <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
              Used in {{ tag.value }} quote{{ tag.value !== 1 ? "s" : "" }}
            </div>
          </div>
          <div class="flex items-center gap-2 self-end sm:self-center">
            <button
              pButton
              icon="pi pi-pencil"
              class="p-button-rounded p-button-text p-button-sm"
              (click)="editTag(tag.key)"
              pTooltip="Edit Tag"
            ></button>
            <button
              pButton
              icon="pi pi-trash"
              class="p-button-rounded p-button-text p-button-sm text-red-600"
              (click)="deleteTag(tag.key)"
              pTooltip="Delete Tag"
              [disabled]="tag.value > 0"
            ></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bulk Actions -->
    <div
      class="border border-gray-200 dark:border-gray-700 rounded-lg p-3 sm:p-4"
    >
      <h4
        class="font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm sm:text-base"
      >
        <i class="pi pi-cog text-orange-500"></i>
        Bulk Actions
      </h4>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3">
        <button
          pButton
          label="Merge Tags"
          icon="pi pi-arrow-right"
          class="p-button-outlined p-button-sm"
          (click)="openMergeDialog()"
        ></button>
        <button
          pButton
          label="Clean Unused"
          icon="pi pi-trash"
          class="p-button-outlined p-button-warning p-button-sm"
          (click)="cleanUnusedTags()"
          [disabled]="getUnusedTags().length === 0"
        ></button>
        <button
          pButton
          label="Export Tags"
          icon="pi pi-download"
          class="p-button-outlined p-button-info p-button-sm"
          (click)="exportTags()"
        ></button>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3">
      <button
        pButton
        label="Close"
        icon="pi pi-times"
        class="p-button-outlined p-button-sm w-full sm:w-auto"
        (click)="displayTagDialog = false"
      ></button>
    </div>
  </ng-template>
</p-dialog>
