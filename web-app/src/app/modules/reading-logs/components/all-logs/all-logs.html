<div class="p-6">
  <!-- Currently Reading Books Strip -->
  <div *ngIf="readingLogs.length > 0" class="mb-10 p-4 rounded-lg">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
      ðŸ“– Currently Reading
      <span class="text-sm">({{ readingLogs.length }})</span>
    </h2>
    <div class="flex overflow-x-auto gap-5 no-scrollbar mt-5">
      <p-card
        *ngFor="let log of readingLogs"
        class="flex-shrink-0 w-64 shadow-md rounded-lg hover:shadow-lg transition-shadow"
      >
        <div
          class="font-semibold text-lg mb-1 truncate"
          title="{{ log.title }}"
        >
          {{ log.title }}
        </div>
        <div class="text-sm mb-2 truncate" title="{{ log.author }}">
          by {{ log.author }}
        </div>
        <div class="mb-2">
          <span
            [ngClass]="getStatusBadgeClass(log.status)"
            class="px-3 py-1 rounded text-xs inline-block font-medium"
            >{{ log.status }}</span
          >
        </div>
        <div class="text-sm mb-2">Started: {{ formatDate(log.startDate) }}</div>
        <div class="text-sm mb-4">
          Est. Time: {{ log.estimatedTimeHrs ?? "-" }} hrs
        </div>

        <div class="flex justify-end">
          <button
            pButton
            icon="pi pi-eye"
            class="p-button-rounded p-button-text p-button-info p-button-sm"
            (click)="viewLog(log)"
          >
            view
          </button>
        </div>
      </p-card>
    </div>
  </div>

  <hr class="my-4" />

  <!-- Reading Logs Section -->
  <div class="pt-8">
    <!-- Header + Actions -->
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6"
    >
      <h1 class="text-2xl font-bold flex items-center gap-2">
        ðŸ“– Reading Logs
        <span class="text-gray-500 text-sm">({{ filteredLogs.length }})</span>
      </h1>
      <div class="flex items-center gap-3">
        <button
          pButton
          label="Add New Log"
          icon="pi pi-plus"
          class="p-button-success"
        ></button>
        <button
          pButton
          label="Export CSV"
          icon="pi pi-upload"
          class="p-button-secondary"
          (click)="exportCSV()"
        ></button>
      </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap items-center gap-4 mb-6 rounded-md">
      <input
        type="text"
        pInputText
        placeholder="ðŸ”Ž Search by title or author"
        class="w-64"
        [(ngModel)]="globalFilter"
        (input)="applyFilters()"
      />

      <p-select
        [options]="statusOptions"
        [(ngModel)]="selectedStatus"
        placeholder="Filter by Status"
        (onChange)="applyFilters()"
        class="w-48"
        showClear="true"
      ></p-select>

      <p-multiSelect
        [options]="authorOptions"
        [(ngModel)]="selectedAuthors"
        placeholder="Filter by Author"
        (onChange)="applyFilters()"
        class="w-56"
        optionLabel="label"
        display="chip"
      ></p-multiSelect>

      <button
        pButton
        class="p-button-text"
        label="Clear"
        (click)="clearFilters()"
      ></button>
    </div>

    <!-- Table View -->
    <div>
      <p-table
        [value]="filteredLogs"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5, 10, 20]"
        class="shadow rounded-lg"
        [responsiveLayout]="'scroll'"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="title" class="text-left px-4 py-2">
              Title <p-sortIcon field="title"></p-sortIcon>
            </th>
            <th pSortableColumn="author" class="text-left px-4 py-2">
              Author <p-sortIcon field="author"></p-sortIcon>
            </th>
            <th class="text-left px-4 py-2">Start Date</th>
            <th class="text-left px-4 py-2">Finish Date</th>
            <th pSortableColumn="status" class="text-left px-4 py-2">
              Status <p-sortIcon field="status"></p-sortIcon>
            </th>
            <th class="text-left px-4 py-2">Est. Time (hrs)</th>
            <th class="text-left px-4 py-2">Actual Time (hrs)</th>
            <th class="text-center px-4 py-2">Progress</th>
            <th class="text-center px-4 py-2">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-log>
          <tr>
            <td
              class="px-4 py-2 font-semibold truncate"
              title="{{ log.title }}"
            >
              {{ log.title }}
            </td>
            <td class="px-4 py-2 truncate" title="{{ log.author }}">
              {{ log.author }}
            </td>
            <td class="px-4 py-2">{{ formatDate(log.startDate) }}</td>
            <td class="px-4 py-2">{{ formatDate(log.finishDate) }}</td>
            <td class="px-4 py-2">
              <span
                [ngClass]="getStatusBadgeClass(log.status)"
                class="px-2 py-1 rounded text-xs inline-block"
              >
                {{ log.status }}
              </span>
            </td>
            <td class="px-4 py-2">{{ log.estimatedTimeHrs ?? "-" }}</td>
            <td class="px-4 py-2">{{ log.actualTimeHrs ?? "-" }}</td>
            <td class="px-4 py-2 text-center">
              <ng-container [ngSwitch]="log.status">
                <span *ngSwitchCase="'Finished'">100%</span>
                <span *ngSwitchCase="'Reading'">
                  {{
                    log.actualTimeHrs && log.estimatedTimeHrs
                      ? ((log.actualTimeHrs / log.estimatedTimeHrs) * 100
                          | number : "1.0-0") + "%"
                      : "-"
                  }}
                </span>
                <span *ngSwitchDefault>-</span>
              </ng-container>
            </td>
            <td class="px-4 py-2 text-center">
              <button
                pButton
                pRipple
                icon="pi pi-eye"
                class="p-button-rounded p-button-info p-button-sm mr-2"
                (click)="viewLog(log)"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-pencil"
                class="p-button-rounded p-button-warning p-button-sm mr-2"
                (click)="editLog(log)"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-sm"
                (click)="deleteLog(log)"
              ></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
