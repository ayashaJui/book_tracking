<div class="min-h-screen">
  <!-- Modern Header Section -->
  <div
    class="max-w-7xl mx-auto relative overflow-hidden bg-white rounded-2xl dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700"
  >
    <!-- Background Pattern -->
    <div
      class="absolute inset-0 bg-gradient-to-br from-gray-50 via-purple-50 to-pink-100 dark:from-gray-800 dark:via-gray-900 dark:to-gray-900"
    ></div>
    <div class="absolute inset-0 opacity-30 dark:opacity-10">
      <div
        class="w-full h-full"
        style="
          background-image: radial-gradient(
            circle at 1px 1px,
            rgba(168, 85, 247, 0.3) 1px,
            transparent 0
          );
          background-size: 20px 20px;
        "
      ></div>
    </div>

    <div class="relative px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
      <div class="max-w-7xl mx-auto">
        <div
          class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 lg:gap-8"
        >
          <!-- Left Side - Title and Description -->
          <div class="flex-1">
            <div class="flex items-center gap-4">
              <div
                class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg"
              >
                <i class="pi pi-heart text-white text-xl"></i>
              </div>
              <div>
                <h1
                  class="text-3xl lg:text-4xl font-bold text-gray-800 dark:text-white tracking-tight"
                >
                  My Wishlist
                </h1>
                <p
                  class="text-gray-600 dark:text-gray-300 text-sm lg:text-base mt-1"
                >
                  Manage your dream book collection
                </p>
              </div>
            </div>
          </div>

          <!-- Right Side - Quick Stats -->
          <div class="flex-shrink-0 w-full lg:w-auto">
            <div class="grid grid-cols-3 gap-4 lg:gap-6">
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-purple-600 dark:text-purple-200"
                    >{{ wishlist.length }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-200"
                >
                  Books
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-green-600 dark:text-green-200"
                    >{{ getBooksByStatus("Purchased").length }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-300"
                >
                  Purchased
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-14 h-14 lg:w-16 lg:h-16 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex items-center justify-center mb-2 lg:mb-3 border border-gray-200 dark:border-gray-700 mx-auto"
                >
                  <span
                    class="text-xl lg:text-2xl font-bold text-blue-600 dark:text-blue-300"
                    >{{ getBooksByPriority("High").length }}</span
                  >
                </div>
                <p
                  class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-300"
                >
                  High Priority
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Container -->
  <div class="py-6 lg:py-8 max-w-7xl mx-auto">
    <!-- Budget Overview Section -->
    <div *ngIf="wishlist.length > 0" class="mb-10">
      <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"
      >
        <div class="flex items-center gap-3 mb-6">
          <div
            class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center"
          >
            <i class="pi pi-wallet text-white text-sm"></i>
          </div>
          <div class="flex-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">
              Monthly Budget vs Wishlist Cost
            </h2>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Track your wishlist total against your monthly budget
            </p>
          </div>
          <div class="flex items-center gap-2">
            <button
              pButton
              icon="pi pi-pencil"
              class="p-button-text p-button-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200"
              (click)="editBudget()"
              pTooltip="Edit Monthly Budget"
            ></button>
            <button
              pButton
              icon="pi pi-history"
              class="p-button-text p-button-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200"
              (click)="viewBudgetHistory()"
              pTooltip="Budget History"
            ></button>
          </div>
        </div>

        <div class="space-y-4">
          <!-- Budget Progress Bar -->
          <div>
            <div
              class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2"
            >
              <span>Budget Progress</span>
              <span
                >{{ budgetProgress | number : "1.1-1" }}% ({{
                  totalPrice | currency : "USD"
                }}
                / {{ monthlyBudget | currency : "USD" }})</span
              >
            </div>
            <div
              class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden"
            >
              <div
                class="h-3 rounded-full transition-all duration-300"
                [style.width.%]="getProgressBarWidth()"
                [ngClass]="{
                  'bg-gradient-to-r from-green-500 to-emerald-600':
                    budgetProgress <= 80,
                  'bg-gradient-to-r from-orange-500 to-orange-600':
                    budgetProgress > 80 && budgetProgress <= 100,
                  'bg-gradient-to-r from-red-500 to-red-600':
                    budgetProgress > 100
                }"
              ></div>
            </div>
          </div>

          <!-- Budget Stats -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
              <div
                class="text-2xl font-bold text-green-600 dark:text-green-400"
              >
                {{ monthlyBudget | currency : "USD" }}
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400">
                Monthly Budget
              </div>
            </div>
            <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
              <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                {{ totalPrice | currency : "USD" }}
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400">
                Wishlist Total
              </div>
            </div>
            <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
              <div
                class="text-2xl font-bold"
                [class.text-green-600]="getRemainingBudget() >= 0"
                [class.dark:text-green-400]="getRemainingBudget() >= 0"
                [class.text-red-600]="getRemainingBudget() < 0"
                [class.dark:text-red-400]="getRemainingBudget() < 0"
              >
                {{ getRemainingBudget() | currency : "USD" }}
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400">
                Remaining
              </div>
            </div>
            <!-- <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
              <div
                class="text-2xl font-bold text-purple-600 dark:text-purple-400"
              >
                {{ getDailyBudget() | currency : "USD" }}
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400">
                Daily Allowance
              </div>
            </div> -->
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Action Buttons and Filters Section -->
    <div class="mb-8">
      <div
        class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6"
      >
        <div class="flex items-center gap-4">
          <h2
            class="text-2xl font-bold flex items-center gap-3 text-gray-800 dark:text-white"
          >
            <div
              class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center"
            >
              <i class="pi pi-list text-white text-sm"></i>
            </div>
            All Wishlist Items
            <span
              class="text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full"
              >{{ filteredWishlist.length }}</span
            >
          </h2>
        </div>
        <div
          class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full sm:w-auto"
        >
          <button
            pButton
            label="Add New"
            icon="pi pi-plus"
            class="p-button-success p-button-raised shadow-lg hover:shadow-xl transition-all duration-200 w-full sm:w-auto"
            (click)="addWish()"
          ></button>
          <button
            pButton
            label="Import"
            icon="pi pi-upload"
            class="p-button-outlined hover:shadow-lg transition-all duration-200 w-full sm:w-auto"
            (click)="importData()"
          ></button>
          <button
            pButton
            label="Export CSV"
            icon="pi pi-download"
            class="p-button-outlined hover:shadow-lg transition-all duration-200 w-full sm:w-auto"
            (click)="exportCSV()"
          ></button>
        </div>
      </div>

      <!-- Enhanced Filters -->
      <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 sm:p-6"
      >
        <!-- Responsive Layout -->
        <div class="space-y-4">
          <!-- Search Bar - Full Width on All Screens -->
          <div class="w-full">
            <div class="flex items-center gap-3">
              <div
                class="w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center flex-shrink-0"
              >
                <i
                  class="pi pi-search text-gray-500 dark:text-gray-400 text-sm"
                ></i>
              </div>
              <input
                pInputText
                type="text"
                placeholder="Search by title, author, or notes..."
                class="w-full rounded-lg"
                [(ngModel)]="globalFilter"
                (input)="applyFilters()"
              />
            </div>
          </div>

          <!-- Filters Grid - Responsive Layout -->
          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-3 sm:gap-4"
          >
            <!-- Priority Filter -->
            <div class="flex flex-col gap-1">
              <label
                class="text-xs font-medium text-gray-600 dark:text-gray-400"
                >Priority</label
              >
              <p-select
                [showClear]="true"
                [options]="priorityOptions"
                [(ngModel)]="selectedPriority"
                (onChange)="applyFilters()"
                class="w-full"
                placeholder="All"
              ></p-select>
            </div>

            <!-- Status Filter -->
            <div class="flex flex-col gap-1">
              <label
                class="text-xs font-medium text-gray-600 dark:text-gray-400"
                >Status</label
              >
              <p-select
                [showClear]="true"
                [options]="statusOptions"
                [(ngModel)]="selectedStatus"
                (onChange)="applyFilters()"
                class="w-full"
                placeholder="All"
              ></p-select>
            </div>

            <!-- Price Range Filter -->
            <div class="flex flex-col gap-1">
              <label
                class="text-xs font-medium text-gray-600 dark:text-gray-400"
                >Price Range</label
              >
              <p-select
                [showClear]="true"
                [options]="priceRangeOptions"
                [(ngModel)]="selectedPriceRange"
                (onChange)="applyFilters()"
                class="w-full"
                placeholder="All"
              ></p-select>
            </div>

            <!-- Date Filter -->
            <div class="flex flex-col gap-1">
              <label
                class="text-xs font-medium text-gray-600 dark:text-gray-400"
                >Added</label
              >
              <p-select
                [showClear]="true"
                [options]="dateRangeOptions"
                [(ngModel)]="selectedDateRange"
                (onChange)="applyFilters()"
                class="w-full"
                placeholder="All time"
              ></p-select>
            </div>

            <!-- Action Buttons -->
            <div
              class="flex flex-col gap-1 sm:col-span-2 lg:col-span-1 xl:col-span-2"
            >
              <label
                class="text-xs font-medium text-gray-600 dark:text-gray-400 opacity-0"
              >
                Actions
              </label>
              <div class="flex gap-2">
                <button
                  pButton
                  icon="pi pi-times"
                  class="p-button-text p-button-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 flex-1 sm:flex-none"
                  (click)="clearFilters()"
                  pTooltip="Clear all filters"
                  label="Clear"
                ></button>
                <button
                  pButton
                  icon="pi pi-sort-amount-down"
                  class="p-button-text p-button-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 flex-1 sm:flex-none"
                  (click)="toggleSortOrder()"
                  pTooltip="Toggle sort order"
                  [label]="sortOrder === 'desc' ? 'Newest' : 'Oldest'"
                ></button>
                <button
                  pButton
                  icon="pi pi-refresh"
                  class="p-button-text p-button-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 flex-1 sm:flex-none"
                  (click)="refreshData()"
                  pTooltip="Refresh data"
                ></button>
              </div>
            </div>
          </div>
        </div>

        <!-- Filter Summary -->
        <div
          *ngIf="getActiveFiltersCount() > 0"
          class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600"
        >
          <div
            class="flex flex-col sm:flex-row sm:items-center gap-2 text-sm text-gray-600 dark:text-gray-400"
          >
            <div class="flex items-center gap-2">
              <i class="pi pi-filter text-xs"></i>
              <span>{{ getActiveFiltersCount() }} filter(s) active</span>
            </div>
            <div
              class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2"
            >
              <span class="hidden sm:inline">•</span>
              <span
                >{{ filteredWishlist.length }} of {{ wishlist.length }} books
                shown</span
              >
              <span class="hidden sm:inline">•</span>
              <span class="font-medium text-green-600 dark:text-green-400">
                Total: {{ totalPrice | currency : "USD" }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Cards -->
    <div *ngIf="wishlist.length > 0" class="mb-8">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- High Priority Books -->
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all duration-200 cursor-pointer"
          (click)="filterByPriority('High')"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                High Priority
              </p>
              <p class="text-2xl font-bold text-red-600 dark:text-red-400">
                {{ getBooksByPriority("High").length }}
              </p>
            </div>
            <div
              class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center"
            >
              <i
                class="pi pi-exclamation-triangle text-red-600 dark:text-red-400"
              ></i>
            </div>
          </div>
        </div>

        <!-- Books to Purchase -->
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all duration-200 cursor-pointer"
          (click)="filterByStatus('Planned')"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                To Purchase
              </p>
              <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                {{ getBooksByStatus("Planned").length }}
              </p>
            </div>
            <div
              class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center"
            >
              <i
                class="pi pi-shopping-cart text-blue-600 dark:text-blue-400"
              ></i>
            </div>
          </div>
        </div>

        <!-- Recent Additions -->
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all duration-200 cursor-pointer"
          (click)="filterByDateRange('30d')"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Recent (30d)
              </p>
              <p class="text-2xl font-bold text-green-600 dark:text-green-400">
                {{ getRecentBooks(30).length }}
              </p>
            </div>
            <div
              class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center"
            >
              <i class="pi pi-clock text-green-600 dark:text-green-400"></i>
            </div>
          </div>
        </div>

        <!-- Average Price -->
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Avg. Price</p>
              <p
                class="text-2xl font-bold text-purple-600 dark:text-purple-400"
              >
                {{ getAveragePrice() | currency : "USD" }}
              </p>
            </div>
            <div
              class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center"
            >
              <i
                class="pi pi-chart-bar text-purple-600 dark:text-purple-400"
              ></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Table View -->
    <div class="rounded-2xl shadow-sm overflow-hidden">
      <p-table
        #dt
        [value]="filteredWishlist"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        [responsiveLayout]="'scroll'"
        stripedRows
        [tableStyle]="{ 'min-width': '70rem' }"
        [globalFilterFields]="['title', 'author', 'status']"
      >
        <ng-template pTemplate="header">
          <tr
            class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-800"
          >
            <th
              pSortableColumn="title"
              class="px-6 py-4 text-left font-semibold"
            >
              <div class="flex items-center gap-2">
                <i class="pi pi-book text-purple-500"></i>
                Title
                <p-sortIcon field="title"></p-sortIcon>
              </div>
            </th>
            <th
              pSortableColumn="author"
              class="px-6 py-4 text-left font-semibold"
            >
              <div class="flex items-center gap-2">
                <i class="pi pi-user text-purple-500"></i>
                Author
                <p-sortIcon field="author"></p-sortIcon>
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-dollar text-purple-500"></i>
                Price
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-calendar text-purple-500"></i>
                Date Added
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-star text-purple-500"></i>
                Priority
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-flag text-purple-500"></i>
                Status
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-file-edit text-purple-500"></i>
                Notes
              </div>
            </th>
            <th class="px-6 py-4 text-center font-semibold">
              <div class="flex items-center justify-center gap-2">
                <i class="pi pi-cog text-purple-500"></i>
                Actions
              </div>
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-book>
          <tr class="transition-all duration-200">
            <td class="px-6 py-4 text-left">
              <div
                class="font-semibold text-gray-900 dark:text-white truncate max-w-xs"
                title="{{ book.title }}"
              >
                {{ book.title }}
              </div>
            </td>
            <td class="px-6 py-4 text-left">
              <div
                class="font-medium text-gray-700 dark:text-gray-300 truncate"
                title="{{ book.author }}"
              >
                {{ book.author }}
              </div>
            </td>
            <td class="px-6 py-4 text-center">
              <span class="font-semibold text-green-600 dark:text-green-400">
                {{ book.price | currency : "USD" }}
              </span>
            </td>
            <td class="px-6 py-4 text-center">
              <div
                class="flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400"
              >
                <i class="pi pi-calendar text-xs"></i>
                {{ book.dateAdded | date : "mediumDate" }}
              </div>
            </td>
            <td class="px-6 py-4 text-center">
              <p-badge
                [value]="book.priority"
                [severity]="getPrioritySeverity(book.priority)"
                class="shadow-sm"
              ></p-badge>
            </td>
            <td class="px-6 py-4 text-center">
              <p-badge
                [value]="book.status"
                [severity]="getStatusSeverity(book.status)"
                class="shadow-sm"
              ></p-badge>
            </td>
            <td class="px-6 py-4 text-center">
              <div
                class="max-w-xs truncate text-sm text-gray-600 dark:text-gray-400"
                title="{{ book.notes || 'No notes' }}"
              >
                {{ book.notes || "-" }}
              </div>
            </td>
            <td class="px-6 py-4 text-center">
              <div class="flex items-center justify-center gap-2">
                <button
                  pButton
                  pRipple
                  icon="pi pi-eye"
                  class="p-button-rounded p-button-text p-button-info p-button-sm transition-all duration-200"
                  (click)="viewBook(book)"
                  pTooltip="View Details"
                ></button>
                <button
                  pButton
                  pRipple
                  icon="pi pi-pencil"
                  class="p-button-rounded p-button-text p-button-warning p-button-sm transition-all duration-200"
                  (click)="editBook(book)"
                  pTooltip="Edit Book"
                ></button>
                <button
                  pButton
                  pRipple
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-text p-button-danger p-button-sm transition-all duration-200"
                  (click)="deleteBook(book)"
                  pTooltip="Delete Book"
                ></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="footer">
          <tr class="bg-gray-50 dark:bg-gray-700">
            <td colspan="2" class="px-6 py-4 text-right font-bold">Totals:</td>
            <td
              class="px-6 py-4 text-center font-bold text-green-600 dark:text-green-400"
            >
              {{ totalPrice | currency : "USD" }}
            </td>
            <td
              colspan="5"
              class="px-6 py-4 text-center font-bold text-gray-700 dark:text-gray-300"
            >
              {{ filteredWishlist.length }} Books in Wishlist
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8" class="text-center py-12">
              <div class="flex flex-col items-center text-center gap-4">
                <div class="p-8 bg-white/70 backdrop-blur-sm rounded-full">
                  <i class="pi pi-heart text-6xl text-gray-400"></i>
                </div>
                <div>
                  <h3
                    class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-300"
                  >
                    No books in your wishlist
                  </h3>
                  <p class="text-gray-500 dark:text-gray-400 mb-6">
                    Start building your dream book collection by adding your
                    first wish!
                  </p>
                  <button
                    pButton
                    label="Add Your First Book"
                    icon="pi pi-plus"
                    class="p-button-success p-button-lg"
                    (click)="addWish()"
                  ></button>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- Budget Edit Dialog -->
<p-dialog
  header="Edit Monthly Budget"
  [(visible)]="showBudgetDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '90vw', maxWidth: '500px' }"
  styleClass="budget-dialog"
>
  <div class="space-y-6">
    <!-- Current Budget Info -->
    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
      <div class="flex items-center justify-between mb-2">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Current Budget:</span
        >
        <span class="text-lg font-bold text-green-600 dark:text-green-400">
          {{ monthlyBudget | currency : "USD" }}
        </span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Spent This Month:</span
        >
        <span class="text-lg font-bold text-blue-600 dark:text-blue-400">
          {{ totalPrice | currency : "USD" }}
        </span>
      </div>
    </div>

    <!-- New Budget Input -->
    <div class="space-y-3">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
        New Monthly Budget
      </label>
      <div class="flex items-center gap-3">
        <span class="text-gray-500 dark:text-gray-400">$</span>
        <input
          pInputText
          type="number"
          min="0"
          step="10"
          [(ngModel)]="newBudgetAmount"
          class="flex-1 rounded-lg"
          placeholder="Enter new budget amount"
        />
      </div>
    </div>

    <!-- Budget Suggestions -->
    <div class="space-y-3">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
        Quick Suggestions
      </label>
      <div class="grid grid-cols-3 gap-2">
        <button
          *ngFor="let suggestion of budgetSuggestions"
          pButton
          [label]="suggestion.label"
          class="p-button-outlined p-button-sm"
          (click)="setBudgetSuggestion(suggestion.value)"
        ></button>
      </div>
    </div>

    <!-- Budget Analysis -->
    <div
      *ngIf="newBudgetAmount > 0"
      class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 space-y-2"
    >
      <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200">
        Budget Analysis
      </h4>
      <div class="text-sm text-blue-700 dark:text-blue-300">
        <div class="flex justify-between">
          <span>Daily allowance:</span>
          <span class="font-medium">{{
            newBudgetAmount / 30 | currency : "USD"
          }}</span>
        </div>
        <div class="flex justify-between">
          <span>Weekly allowance:</span>
          <span class="font-medium">{{
            newBudgetAmount / 4.33 | currency : "USD"
          }}</span>
        </div>
        <div class="flex justify-between">
          <span>vs Current spending:</span>
          <span
            class="font-medium"
            [class.text-green-600]="newBudgetAmount >= totalPrice"
            [class.text-red-600]="newBudgetAmount < totalPrice"
          >
            {{
              newBudgetAmount >= totalPrice ? "Within budget" : "Over budget"
            }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-3">
      <button
        pButton
        label="Cancel"
        icon="pi pi-times"
        class="p-button-text"
        (click)="cancelBudgetEdit()"
      ></button>
      <button
        pButton
        label="Save Budget"
        icon="pi pi-check"
        class="p-button-success"
        [disabled]="!newBudgetAmount || newBudgetAmount <= 0"
        (click)="saveBudget()"
      ></button>
    </div>
  </ng-template>
</p-dialog>

<!-- Budget History Dialog -->
<p-dialog
  header="Budget History"
  [(visible)]="showBudgetHistoryDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '90vw', maxWidth: '600px' }"
>
  <div class="space-y-4">
    <div
      *ngFor="let entry of budgetHistory"
      class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"
    >
      <div>
        <div class="font-medium text-gray-900 dark:text-white">
          {{ entry.amount | currency : "USD" }}
        </div>
        <div class="text-sm text-gray-500 dark:text-gray-400">
          {{ entry.date | date : "mediumDate" }}
        </div>
      </div>
      <div class="text-sm text-gray-600 dark:text-gray-400">
        {{ entry.reason }}
      </div>
    </div>
    <div
      *ngIf="budgetHistory.length === 0"
      class="text-center py-8 text-gray-500 dark:text-gray-400"
    >
      No budget history available
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Close"
      icon="pi pi-times"
      class="p-button-text"
      (click)="showBudgetHistoryDialog = false"
    ></button>
  </ng-template>
</p-dialog>

<!-- Import Data Dialog -->
<p-dialog
  header="Import Wishlist Data"
  [(visible)]="showImportDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '90vw', maxWidth: '600px' }"
  styleClass="import-dialog"
>
  <div class="space-y-6">
    <!-- File Upload Section -->
    <div *ngIf="!importPreview" class="space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <i
            class="pi pi-info-circle text-blue-600 dark:text-blue-400 mt-0.5"
          ></i>
          <div class="text-sm text-blue-800 dark:text-blue-200 flex-1">
            <p class="font-medium mb-1">CSV Format Expected:</p>
            <p>
              Your CSV file should contain columns: title, author, price,
              priority, status, notes
            </p>
            <p class="mt-1 text-xs">
              Priority: High/Medium/Low | Status: Planned/Purchased/Reading/On
              Hold
            </p>
            <button
              type="button"
              class="mt-2 text-xs text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100 underline cursor-pointer"
              (click)="downloadSampleCSV()"
            >
              Download sample CSV template
            </button>
          </div>
        </div>
      </div>

      <div
        class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:border-purple-400 transition-colors"
      >
        <p-fileUpload
          mode="advanced"
          [auto]="false"
          accept=".csv"
          [maxFileSize]="1000000"
          (onSelect)="onFileSelect($event)"
          [showUploadButton]="false"
          [showCancelButton]="false"
        >
          <ng-template pTemplate="content">
            <div class="text-center">
              <i class="pi pi-cloud-upload text-4xl text-gray-400 mb-4"></i>
              <p
                class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2"
              >
                Drop your CSV file here or click to browse
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Maximum file size: 1MB
              </p>
            </div>
          </ng-template>
        </p-fileUpload>
      </div>
    </div>

    <!-- Import Preview Section -->
    <div *ngIf="importPreview" class="space-y-4">
      <!-- Summary Stats -->
      <div class="grid grid-cols-2 gap-4">
        <div
          class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4 text-center"
        >
          <div class="text-2xl font-bold text-green-600 dark:text-green-400">
            {{ importBooks.length }}
          </div>
          <div class="text-sm text-green-700 dark:text-green-300">
            Valid Books
          </div>
        </div>
        <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-red-600 dark:text-red-400">
            {{ importErrors.length }}
          </div>
          <div class="text-sm text-red-700 dark:text-red-300">Errors</div>
        </div>
      </div>

      <!-- Errors Display -->
      <div
        *ngIf="importErrors.length > 0"
        class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4"
      >
        <h4 class="text-sm font-medium text-red-800 dark:text-red-200 mb-2">
          Import Errors:
        </h4>
        <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">
          <li *ngFor="let error of importErrors">• {{ error }}</li>
        </ul>
      </div>

      <!-- Preview Table -->
      <div *ngIf="importBooks.length > 0" class="space-y-3">
        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">
          Preview (showing first 5 books):
        </h4>
        <div class="overflow-x-auto bg-gray-50 dark:bg-gray-700 rounded-xl">
          <table class="w-full text-sm">
            <thead class="bg-gray-100 dark:bg-gray-600">
              <tr>
                <th class="px-3 py-2 text-left">Title</th>
                <th class="px-3 py-2 text-left">Author</th>
                <th class="px-3 py-2 text-center">Price</th>
                <th class="px-3 py-2 text-center">Priority</th>
                <th class="px-3 py-2 text-center">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let book of importBooks.slice(0, 5)"
                class="border-t border-gray-200 dark:border-gray-600"
              >
                <td class="px-3 py-2 font-medium">{{ book.title }}</td>
                <td class="px-3 py-2">{{ book.author }}</td>
                <td class="px-3 py-2 text-center">
                  {{ book.price | currency : "USD" }}
                </td>
                <td class="px-3 py-2 text-center">
                  <span
                    class="px-2 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-600"
                  >
                    {{ book.priority }}
                  </span>
                </td>
                <td class="px-3 py-2 text-center">
                  <span
                    class="px-2 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-600"
                  >
                    {{ book.status }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <p
          *ngIf="importBooks.length > 5"
          class="text-xs text-gray-500 dark:text-gray-400 text-center"
        >
          ... and {{ importBooks.length - 5 }} more books
        </p>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-3">
      <button
        pButton
        label="Cancel"
        icon="pi pi-times"
        class="p-button-text"
        (click)="cancelImport()"
      ></button>
      <button
        *ngIf="!importPreview"
        pButton
        label="Upload File"
        icon="pi pi-upload"
        class="p-button-outlined"
        disabled
      ></button>
      <button
        *ngIf="importPreview"
        pButton
        label="Back to Upload"
        icon="pi pi-arrow-left"
        class="p-button-outlined"
        (click)="resetImport()"
      ></button>
      <button
        *ngIf="importPreview && importBooks.length > 0"
        pButton
        label="Import {{ importBooks.length }} Books"
        icon="pi pi-check"
        class="p-button-success"
        (click)="confirmImport()"
      ></button>
    </div>
  </ng-template>
</p-dialog>

<!-- View Book Details Dialog -->
<p-dialog
  [header]="selectedBook?.title || 'Book Details'"
  [(visible)]="showViewDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '90vw', maxWidth: '500px' }"
  styleClass="view-book-dialog"
>
  <div *ngIf="selectedBook" class="space-y-6">
    <!-- Book Header -->
    <div class="text-center pb-4 border-b border-gray-200 dark:border-gray-600">
      <div
        class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center mx-auto mb-3"
      >
        <i class="pi pi-book text-white text-2xl"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-1">
        {{ selectedBook.title }}
      </h3>
      <p class="text-gray-600 dark:text-gray-400">
        by {{ selectedBook.author }}
      </p>
    </div>

    <!-- Book Details Grid -->
    <div class="grid grid-cols-2 gap-4">
      <div class="space-y-1">
        <label class="text-xs font-medium text-gray-500 dark:text-gray-400"
          >Price</label
        >
        <div class="text-lg font-bold text-green-600 dark:text-green-400">
          {{ selectedBook.price | currency : "USD" }}
        </div>
      </div>
      <div class="space-y-1">
        <label class="text-xs font-medium text-gray-500 dark:text-gray-400"
          >Date Added</label
        >
        <div class="text-sm text-gray-700 dark:text-gray-300">
          {{ selectedBook.dateAdded | date : "mediumDate" }}
        </div>
      </div>
      <div class="space-y-1">
        <label class="text-xs font-medium text-gray-500 dark:text-gray-400"
          >Priority</label
        >
        <div>
          <p-badge
            [value]="selectedBook.priority"
            [severity]="getPrioritySeverity(selectedBook.priority)"
          ></p-badge>
        </div>
      </div>
      <div class="space-y-1">
        <label class="text-xs font-medium text-gray-500 dark:text-gray-400"
          >Status</label
        >
        <div>
          <p-badge
            [value]="selectedBook.status"
            [severity]="getStatusSeverity(selectedBook.status)"
          ></p-badge>
        </div>
      </div>
    </div>

    <!-- Notes Section -->
    <div *ngIf="selectedBook.notes" class="space-y-2">
      <label class="text-xs font-medium text-gray-500 dark:text-gray-400"
        >Notes</label
      >
      <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4">
        <p class="text-sm text-gray-700 dark:text-gray-300">
          {{ selectedBook.notes }}
        </p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-600">
      <button
        pButton
        label="Edit"
        icon="pi pi-pencil"
        class="p-button-outlined flex-1"
        (click)="editBookFromView()"
      ></button>
      <button
        pButton
        label="Delete"
        icon="pi pi-trash"
        class="p-button-outlined p-button-danger flex-1"
        (click)="deleteBookFromView()"
      ></button>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Close"
      icon="pi pi-times"
      class="p-button-text"
      (click)="showViewDialog = false"
    ></button>
  </ng-template>
</p-dialog>

<!-- Delete Confirmation Dialog -->
<p-confirmDialog
  [style]="{ width: '90vw', maxWidth: '450px' }"
  styleClass="confirm-dialog"
></p-confirmDialog>

<!-- Toast Messages -->
<p-toast position="top-right"></p-toast>
